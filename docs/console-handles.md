---
title: 主控台控制碼
description: 主控台進程會使用控制碼來存取其主控台的輸入和螢幕緩衝區，包括 GetStdHandle、CreateFile 或 CreateConsoleScreenBuffer 函數。
author: miniksa
ms.author: miniksa
ms.topic: article
keywords: 主控台，字元模式應用程式，命令列應用程式，終端應用程式，主控台 api
MS-HAID:
- '\_win32\_console\_handles'
- base.console\_handles
- consoles.console\_handles
MSHAttr:
- PreferredSiteName:MSDN
- PreferredLib:/library/windows/desktop
ms.assetid: dc723046-b3e9-418a-b386-79be411e5ac8
ms.openlocfilehash: 50b1ca460818080461116df85bf51387c024df89
ms.sourcegitcommit: b75f4688e080d300b80c552d0711fdd86b9974bf
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/24/2020
ms.locfileid: "89059071"
---
# <a name="console-handles"></a><span data-ttu-id="a1cab-104">主控台控制碼</span><span class="sxs-lookup"><span data-stu-id="a1cab-104">Console Handles</span></span>


<span data-ttu-id="a1cab-105">主控台進程會使用控制碼來存取其主控台的輸入和螢幕緩衝區。</span><span class="sxs-lookup"><span data-stu-id="a1cab-105">A console process uses handles to access the input and screen buffers of its console.</span></span> <span data-ttu-id="a1cab-106">處理常式可以使用 [**GetStdHandle**](getstdhandle.md)、 [**CreateFile**](https://msdn.microsoft.com/library/windows/desktop/aa363858)或 [**CreateConsoleScreenBuffer**](createconsolescreenbuffer.md) 函數來開啟這些控制碼的其中一個。</span><span class="sxs-lookup"><span data-stu-id="a1cab-106">A process can use the [**GetStdHandle**](getstdhandle.md), [**CreateFile**](https://msdn.microsoft.com/library/windows/desktop/aa363858), or [**CreateConsoleScreenBuffer**](createconsolescreenbuffer.md) function to open one of these handles.</span></span>

<span data-ttu-id="a1cab-107">[**GetStdHandle**](getstdhandle.md)函式會提供一種機制，用來抓取標準輸入 (STDIN) 、標準輸出 (STDOUT) ，以及與處理常式相關聯的標準錯誤 (STDERR) 控制碼。</span><span class="sxs-lookup"><span data-stu-id="a1cab-107">The [**GetStdHandle**](getstdhandle.md) function provides a mechanism for retrieving the standard input (STDIN), standard output (STDOUT), and standard error (STDERR) handles associated with a process.</span></span> <span data-ttu-id="a1cab-108">在主控台建立期間，系統會建立這些控制碼。</span><span class="sxs-lookup"><span data-stu-id="a1cab-108">During console creation, the system creates these handles.</span></span> <span data-ttu-id="a1cab-109">一開始，STDIN 是主控台輸入緩衝區的控制碼，而 STDOUT 和 STDERR 是主控台的作用中螢幕緩衝區的控制碼。</span><span class="sxs-lookup"><span data-stu-id="a1cab-109">Initially, STDIN is a handle to the console's input buffer, and STDOUT and STDERR are handles of the console's active screen buffer.</span></span> <span data-ttu-id="a1cab-110">不過， [**SetStdHandle**](setstdhandle.md) 函數可以藉由變更與 STDIN、STDOUT 或 STDERR 相關聯的控制碼，來重新導向標準控制碼。</span><span class="sxs-lookup"><span data-stu-id="a1cab-110">However, the [**SetStdHandle**](setstdhandle.md) function can redirect the standard handles by changing the handle associated with STDIN, STDOUT, or STDERR.</span></span> <span data-ttu-id="a1cab-111">由於父系的標準控制碼會由任何子進程繼承，因此對 **GetStdHandle** 的後續呼叫會傳回重新導向的控制碼。</span><span class="sxs-lookup"><span data-stu-id="a1cab-111">Because the parent's standard handles are inherited by any child process, subsequent calls to **GetStdHandle** return the redirected handle.</span></span> <span data-ttu-id="a1cab-112">因此， **GetStdHandle** 所傳回的控制碼可能會參考主控台 i/o 以外的內容。</span><span class="sxs-lookup"><span data-stu-id="a1cab-112">A handle returned by **GetStdHandle** may, therefore, refer to something other than console I/O.</span></span> <span data-ttu-id="a1cab-113">例如，在建立子進程之前，父進程可以使用 **SetStdHandle** 將管道控制碼設定為子進程繼承的 STDIN 控制碼。</span><span class="sxs-lookup"><span data-stu-id="a1cab-113">For example, before creating a child process, a parent process can use **SetStdHandle** to set a pipe handle to be the STDIN handle that is inherited by the child process.</span></span> <span data-ttu-id="a1cab-114">當子進程呼叫 **GetStdHandle**時，它會取得管道控制碼。</span><span class="sxs-lookup"><span data-stu-id="a1cab-114">When the child process calls **GetStdHandle**, it gets the pipe handle.</span></span> <span data-ttu-id="a1cab-115">這表示父進程可以控制子進程的標準控制碼。</span><span class="sxs-lookup"><span data-stu-id="a1cab-115">This means that the parent process can control the standard handles of the child process.</span></span> <span data-ttu-id="a1cab-116">**GetStdHandle**傳回的控制碼具有泛型 \_ 讀取 |一般 \_ 寫入存取權，除非使用**SetStdHandle**來設定標準控制碼的存取權較少。</span><span class="sxs-lookup"><span data-stu-id="a1cab-116">The handles returned by **GetStdHandle** have GENERIC\_READ | GENERIC\_WRITE access unless **SetStdHandle** has been used to set the standard handle to have lesser access.</span></span>

<span data-ttu-id="a1cab-117">[**GetStdHandle**](getstdhandle.md)所傳回的控制碼值不是0、1和2，因此在 stdio.h .H (STDIN、STDOUT 和 STDERR) 的標準預先定義資料流程常數不能用在需要主控台控制碼的函式中。</span><span class="sxs-lookup"><span data-stu-id="a1cab-117">The value of the handles returned by [**GetStdHandle**](getstdhandle.md) are not 0, 1, and 2, so the standard predefined stream constants in Stdio.h (STDIN, STDOUT, and STDERR) cannot be used in functions that require a console handle.</span></span>

<span data-ttu-id="a1cab-118">[**CreateFile**](https://msdn.microsoft.com/library/windows/desktop/aa363858)函式可讓進程取得其主控台輸入緩衝區和作用中螢幕緩衝區的控制碼，即使已重新導向 STDIN 和 STDOUT 也是如此。</span><span class="sxs-lookup"><span data-stu-id="a1cab-118">The [**CreateFile**](https://msdn.microsoft.com/library/windows/desktop/aa363858) function enables a process to get a handle to its console's input buffer and active screen buffer, even if STDIN and STDOUT have been redirected.</span></span> <span data-ttu-id="a1cab-119">若要開啟主控台輸入緩衝區的控制碼，請在呼叫 **CreateFile**時指定 CONIN $ 值。</span><span class="sxs-lookup"><span data-stu-id="a1cab-119">To open a handle to a console's input buffer, specify the CONIN$ value in a call to **CreateFile**.</span></span> <span data-ttu-id="a1cab-120">在 **CreateFile** 的呼叫中指定 CONOUT $ 值，以開啟主控台的作用中螢幕緩衝區的控制碼。</span><span class="sxs-lookup"><span data-stu-id="a1cab-120">Specify the CONOUT$ value in a call to **CreateFile** to open a handle to a console's active screen buffer.</span></span> <span data-ttu-id="a1cab-121">**CreateFile** 可讓您指定所傳回之控制碼的讀取/寫入存取權。</span><span class="sxs-lookup"><span data-stu-id="a1cab-121">**CreateFile** enables you to specify the read/write access of the handle that it returns.</span></span>

<span data-ttu-id="a1cab-122">[**CreateConsoleScreenBuffer**](createconsolescreenbuffer.md)函式會建立新的螢幕緩衝區，並傳回控制碼。</span><span class="sxs-lookup"><span data-stu-id="a1cab-122">The [**CreateConsoleScreenBuffer**](createconsolescreenbuffer.md) function creates a new screen buffer and returns a handle.</span></span> <span data-ttu-id="a1cab-123">這個控制碼可用於接受主控台輸出之控制碼的任何函式。</span><span class="sxs-lookup"><span data-stu-id="a1cab-123">This handle can be used in any function that accepts a handle to console output.</span></span> <span data-ttu-id="a1cab-124">新的螢幕緩衝區在 [**SetConsoleActiveScreenBuffer**](setconsoleactivescreenbuffer.md) 函式的呼叫中指定其控制碼之前，不會處於使用中狀態。</span><span class="sxs-lookup"><span data-stu-id="a1cab-124">The new screen buffer is not active until its handle is specified in a call to the [**SetConsoleActiveScreenBuffer**](setconsoleactivescreenbuffer.md) function.</span></span> <span data-ttu-id="a1cab-125">請注意，變更主動螢幕緩衝區並不會影響 [**GetStdHandle**](getstdhandle.md)所傳回的控制碼。</span><span class="sxs-lookup"><span data-stu-id="a1cab-125">Note that changing the active screen buffer does not affect the handle returned by [**GetStdHandle**](getstdhandle.md).</span></span> <span data-ttu-id="a1cab-126">同樣地，使用 [**SetStdHandle**](setstdhandle.md) 來變更 STDOUT 控制碼並不會影響使用中的螢幕緩衝區。</span><span class="sxs-lookup"><span data-stu-id="a1cab-126">Similarly, using [**SetStdHandle**](setstdhandle.md) to change the STDOUT handle does not affect the active screen buffer.</span></span>

<span data-ttu-id="a1cab-127">[**CreateFile**](https://msdn.microsoft.com/library/windows/desktop/aa363858)和[**CreateConsoleScreenBuffer**](createconsolescreenbuffer.md)所傳回的主控台控制碼，可用於需要主控台輸入緩衝區或主控台螢幕緩衝區控制碼的任何主控台功能。</span><span class="sxs-lookup"><span data-stu-id="a1cab-127">Console handles returned by [**CreateFile**](https://msdn.microsoft.com/library/windows/desktop/aa363858) and [**CreateConsoleScreenBuffer**](createconsolescreenbuffer.md) can be used in any of the console functions that require a handle to a console's input buffer or of a console screen buffer.</span></span> <span data-ttu-id="a1cab-128">如果 [**GetStdHandle**](getstdhandle.md) 傳回的控制碼未被重新導向來參考主控台 i/o 以外的內容，則可供主控台函式使用。</span><span class="sxs-lookup"><span data-stu-id="a1cab-128">Handles returned by [**GetStdHandle**](getstdhandle.md) can be used by the console functions if they have not been redirected to refer to something other than console I/O.</span></span> <span data-ttu-id="a1cab-129">但是，如果標準控制碼已重新導向為參考檔案或管道，則控制碼只能由 [**ReadFile**](https://msdn.microsoft.com/library/windows/desktop/aa365467) 和 [**WriteFile**](https://msdn.microsoft.com/library/windows/desktop/aa365747) 函式使用。</span><span class="sxs-lookup"><span data-stu-id="a1cab-129">If a standard handle has been redirected to refer to a file or a pipe, however, the handle can only be used by the [**ReadFile**](https://msdn.microsoft.com/library/windows/desktop/aa365467) and [**WriteFile**](https://msdn.microsoft.com/library/windows/desktop/aa365747) functions.</span></span>

<span data-ttu-id="a1cab-130">進程可以使用 [**DuplicateHandle**](https://msdn.microsoft.com/library/windows/desktop/ms724251) 函式來建立重複的主控台控制碼，該控制碼具有不同的存取或可從原始控制碼取得的繼承性。</span><span class="sxs-lookup"><span data-stu-id="a1cab-130">A process can use the [**DuplicateHandle**](https://msdn.microsoft.com/library/windows/desktop/ms724251) function to create a duplicate console handle that has different access or inheritability from the original handle.</span></span> <span data-ttu-id="a1cab-131">不過，請注意，處理常式可以建立重複的主控台控制碼，只供自己使用。</span><span class="sxs-lookup"><span data-stu-id="a1cab-131">Note, however, that a process can create a duplicate console handle only for its own use.</span></span> <span data-ttu-id="a1cab-132">這與其他控制碼類型不同 (例如檔案、管道或 mutex 物件) ， **DuplicateHandle** 可以針對不同的進程建立有效的重複項。</span><span class="sxs-lookup"><span data-stu-id="a1cab-132">This differs from other handle types (such as file, pipe, or mutex objects), for which **DuplicateHandle** can create a duplicate that is valid for a different process.</span></span>

<span data-ttu-id="a1cab-133">若要關閉主控台控制碼，處理常式可以使用 [**CloseHandle**](https://msdn.microsoft.com/library/windows/desktop/ms724211) 函式。</span><span class="sxs-lookup"><span data-stu-id="a1cab-133">To close a console handle, a process can use the [**CloseHandle**](https://msdn.microsoft.com/library/windows/desktop/ms724211) function.</span></span>

 

 




