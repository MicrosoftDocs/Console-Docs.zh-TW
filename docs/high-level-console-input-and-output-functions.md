---
title: High-Level 主控台輸入和輸出功能
description: ReadFile 和 WriteFile 函式，或 ReadConsole 和 WriteConsole 函式可讓應用程式讀取主控台輸入，並以字串流的形式寫入主控台輸出。
author: miniksa
ms.author: miniksa
ms.topic: conceptual
keywords: 主控台, 字元模式應用程式, 命令列應用程式, 終端機應用程式, 主控台 api
MS-HAID:
- '\_win32\_high\_level\_console\_input\_and\_output\_functions'
- base.high\_level\_console\_input\_and\_output\_functions
- consoles.high\_level\_console\_input\_and\_output\_functions
MSHAttr:
- PreferredSiteName:MSDN
- PreferredLib:/library/windows/desktop
ms.assetid: 086b1bec-85f8-4e31-848d-7cb2d2703a3d
ms.openlocfilehash: 4da8845e4e35170980d306930c182ff6e5fb6cbf
ms.sourcegitcommit: 281eb1469f77ae4fb4c67806898e14eac440522a
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 02/14/2021
ms.locfileid: "100358298"
---
# <a name="high-level-console-input-and-output-functions"></a><span data-ttu-id="ffdb0-104">High-Level 主控台輸入和輸出功能</span><span class="sxs-lookup"><span data-stu-id="ffdb0-104">High-Level Console Input and Output Functions</span></span>

<span data-ttu-id="ffdb0-105">[**ReadFile**](/windows/win32/api/fileapi/nf-fileapi-readfile)和 [**WriteFile**](/windows/win32/api/fileapi/nf-fileapi-writefile)函式，或 [**ReadConsole**](readconsole.md)和 [**WriteConsole**](writeconsole.md)函式可讓應用程式讀取主控台輸入，並以字串流的形式寫入主控台輸出。</span><span class="sxs-lookup"><span data-stu-id="ffdb0-105">The [**ReadFile**](/windows/win32/api/fileapi/nf-fileapi-readfile) and [**WriteFile**](/windows/win32/api/fileapi/nf-fileapi-writefile) functions, or the [**ReadConsole**](readconsole.md) and [**WriteConsole**](writeconsole.md) functions, enable an application to read console input and write console output as a stream of characters.</span></span> <span data-ttu-id="ffdb0-106">**ReadConsole** 和 **WriteConsole** 的行為與 **ReadFile** 和 **WriteFile** 的行為完全相同，不同之處在于可以將它們當做寬字元函式使用 (其中 text 引數必須使用 Unicode) 或作為 ANSI 函式 (其中文字引數必須使用 Windows 字元集) 中的字元。</span><span class="sxs-lookup"><span data-stu-id="ffdb0-106">**ReadConsole** and **WriteConsole** behave exactly like **ReadFile** and **WriteFile** except that they can be used either as wide-character functions (in which text arguments must use Unicode) or as ANSI functions (in which text arguments must use characters from the Windows character set).</span></span> <span data-ttu-id="ffdb0-107">需要維護一組來源以支援 Unicode 或 ANSI 字元集的應用程式應該使用 **ReadConsole** 和 **WriteConsole**。</span><span class="sxs-lookup"><span data-stu-id="ffdb0-107">Applications that need to maintain a single set of sources to support either Unicode or the ANSI character set should use **ReadConsole** and **WriteConsole**.</span></span>

<span data-ttu-id="ffdb0-108">[**ReadConsole**](readconsole.md) 和 [**WriteConsole**](writeconsole.md) 只能搭配使用主控台控制碼; [**ReadFile**](/windows/win32/api/fileapi/nf-fileapi-readfile) 和 [**WriteFile**](/windows/win32/api/fileapi/nf-fileapi-writefile) 可搭配其他控制碼使用， (例如檔案或管道) 。</span><span class="sxs-lookup"><span data-stu-id="ffdb0-108">[**ReadConsole**](readconsole.md) and [**WriteConsole**](writeconsole.md) can only be used with console handles; [**ReadFile**](/windows/win32/api/fileapi/nf-fileapi-readfile) and [**WriteFile**](/windows/win32/api/fileapi/nf-fileapi-writefile) can be used with other handles (such as files or pipes).</span></span> <span data-ttu-id="ffdb0-109">**ReadConsole** 和 **WriteConsole** 如果搭配已重新導向且不再是主控台控制碼的標準控制碼使用，則會失敗。</span><span class="sxs-lookup"><span data-stu-id="ffdb0-109">**ReadConsole** and **WriteConsole** fail if used with a standard handle that has been redirected and is no longer a console handle.</span></span>

<span data-ttu-id="ffdb0-110">若要取得鍵盤輸入，處理常式可以使用 [**ReadFile**](/windows/win32/api/fileapi/nf-fileapi-readfile) 或 [**ReadConsole**](readconsole.md) 搭配主控台輸入緩衝區的控制碼，也可以使用 **ReadFile** 從檔案或管道讀取輸入（如果已重新導向） `STDIN` 。</span><span class="sxs-lookup"><span data-stu-id="ffdb0-110">To get keyboard input, a process can use [**ReadFile**](/windows/win32/api/fileapi/nf-fileapi-readfile) or [**ReadConsole**](readconsole.md) with a handle to the console's input buffer, or it can use **ReadFile** to read input from a file or a pipe if `STDIN` has been redirected.</span></span> <span data-ttu-id="ffdb0-111">這些函式只會傳回可轉譯為 ANSI 或 Unicode 字元的鍵盤事件。</span><span class="sxs-lookup"><span data-stu-id="ffdb0-111">These functions only return keyboard events that can be translated into ANSI or Unicode characters.</span></span> <span data-ttu-id="ffdb0-112">可以傳回的輸入包含控制項按鍵組合。</span><span class="sxs-lookup"><span data-stu-id="ffdb0-112">The input that can be returned includes control key combinations.</span></span> <span data-ttu-id="ffdb0-113">這些函式不會傳回包含函式按鍵或箭號按鍵的鍵盤事件。</span><span class="sxs-lookup"><span data-stu-id="ffdb0-113">The functions do not return keyboard events involving the function keys or arrow keys.</span></span> <span data-ttu-id="ffdb0-114">系統會捨棄滑鼠、視窗、焦點或功能表輸入所產生的輸入事件。</span><span class="sxs-lookup"><span data-stu-id="ffdb0-114">Input events generated by mouse, window, focus, or menu input are discarded.</span></span>

<span data-ttu-id="ffdb0-115">如果已啟用行輸入模式 (預設模式) ， [**ReadFile**](/windows/win32/api/fileapi/nf-fileapi-readfile) 和 [**ReadConsole**](readconsole.md) 在按下 ENTER 鍵之前，不會返回呼叫的應用程式。</span><span class="sxs-lookup"><span data-stu-id="ffdb0-115">If line input mode is enabled (the default mode), [**ReadFile**](/windows/win32/api/fileapi/nf-fileapi-readfile) and [**ReadConsole**](readconsole.md) do not return to the calling application until the ENTER key is pressed.</span></span> <span data-ttu-id="ffdb0-116">如果已停用行輸入模式，在至少有一個字元可用之前，函式不會傳回。</span><span class="sxs-lookup"><span data-stu-id="ffdb0-116">If line input mode is disabled, the functions do not return until at least one character is available.</span></span> <span data-ttu-id="ffdb0-117">在任一種模式下，都會讀取所有可用的字元，直到沒有其他可用的索引鍵或已讀取指定的字元數為止。</span><span class="sxs-lookup"><span data-stu-id="ffdb0-117">In either mode, all available characters are read until either no more keys are available or the specified number of characters has been read.</span></span> <span data-ttu-id="ffdb0-118">在下一次讀取作業之前，會緩衝處理未讀取的字元。</span><span class="sxs-lookup"><span data-stu-id="ffdb0-118">Unread characters are buffered until the next read operation.</span></span> <span data-ttu-id="ffdb0-119">這些函數會報告實際讀取的字元總數。</span><span class="sxs-lookup"><span data-stu-id="ffdb0-119">The functions report the total number of characters actually read.</span></span> <span data-ttu-id="ffdb0-120">如果已啟用 echo 輸入模式，這些函式所讀取的字元會寫入目前游標位置的作用中螢幕緩衝區。</span><span class="sxs-lookup"><span data-stu-id="ffdb0-120">If echo input mode is enabled, characters read by these functions are written to the active screen buffer at the current cursor position.</span></span>

<span data-ttu-id="ffdb0-121">處理常式可以使用 [**WriteFile**](/windows/win32/api/fileapi/nf-fileapi-writefile) 或 **WriteConsole** 來寫入作用中或非作用中的螢幕緩衝區，或者可以使用 **WriteFile** 來寫入檔案，或在 STDOUT 重新導向時使用管道。</span><span class="sxs-lookup"><span data-stu-id="ffdb0-121">A process can use [**WriteFile**](/windows/win32/api/fileapi/nf-fileapi-writefile) or **WriteConsole** to write to either an active or inactive screen buffer, or it can use **WriteFile** to write to a file or a pipe if STDOUT has been redirected.</span></span> <span data-ttu-id="ffdb0-122">已處理的輸出模式並在 EOL 輸出模式下換行，可控制字元寫入或送至螢幕緩衝區的方式。</span><span class="sxs-lookup"><span data-stu-id="ffdb0-122">Processed output mode and wrap at EOL output mode control the way characters are written or echoed to a screen buffer.</span></span>

<span data-ttu-id="ffdb0-123">由 [**WriteFile**](/windows/win32/api/fileapi/nf-fileapi-writefile) 或 [**WriteConsole**](writeconsole.md)或由 [**ReadFile**](/windows/win32/api/fileapi/nf-fileapi-readfile) 或 [**ReadConsole**](readconsole.md)所撰寫的字元，會在目前游標位置的螢幕緩衝區中插入。</span><span class="sxs-lookup"><span data-stu-id="ffdb0-123">Characters written by [**WriteFile**](/windows/win32/api/fileapi/nf-fileapi-writefile) or [**WriteConsole**](writeconsole.md), or echoed by [**ReadFile**](/windows/win32/api/fileapi/nf-fileapi-readfile) or [**ReadConsole**](readconsole.md), are inserted in a screen buffer at the current cursor position.</span></span> <span data-ttu-id="ffdb0-124">寫入每個字元時，游標位置會前進到下一個字元資料格;不過，資料列結尾的行為取決於在 EOL 輸出模式下的主控台畫面緩衝區換行。</span><span class="sxs-lookup"><span data-stu-id="ffdb0-124">As each character is written, the cursor position advances to the next character cell; however, the behavior at the end of a row depends on the console screen buffer's wrap at EOL output mode.</span></span>

<span data-ttu-id="ffdb0-125">有關資料指標位置的進一步詳細資料，可透過 **[虛擬終端機序列](console-virtual-terminal-sequences.md)** 找到，特別是在尋找目前位置的 **[查詢狀態](console-virtual-terminal-sequences.md#query-state)** 類別目錄，以及用來設定目前位置的資料 **[指標定位](console-virtual-terminal-sequences.md#cursor-positioning)** 類別目錄。</span><span class="sxs-lookup"><span data-stu-id="ffdb0-125">Further detail about the position of the cursor can be found through **[virtual terminals sequences](console-virtual-terminal-sequences.md)**, specifically in the **[query state](console-virtual-terminal-sequences.md#query-state)** category for finding the current position and the **[cursor positioning](console-virtual-terminal-sequences.md#cursor-positioning)** category for setting the current position.</span></span> <span data-ttu-id="ffdb0-126">或者，應用程式可以使用 [**GetConsoleScreenBufferInfo**](getconsolescreenbufferinfo.md) 函式來判斷目前的資料指標位置，以及使用 [**SetConsoleCursorPosition**](setconsolecursorposition.md) 函數來設定資料指標的位置。</span><span class="sxs-lookup"><span data-stu-id="ffdb0-126">Alternatively, an application can use the [**GetConsoleScreenBufferInfo**](getconsolescreenbufferinfo.md) function to determine the current cursor position and the [**SetConsoleCursorPosition**](setconsolecursorposition.md) function to set the cursor position.</span></span> <span data-ttu-id="ffdb0-127">不過，建議所有新的和進行中的開發都要有 **虛擬終端機序列** 機制。</span><span class="sxs-lookup"><span data-stu-id="ffdb0-127">However, the **virtual terminal sequences** mechanism is preferred for all new and ongoing development.</span></span> <span data-ttu-id="ffdb0-128">如需此決策背後策略的詳細資訊，請參閱 **[傳統功能與虛擬終端](classic-vs-vt.md)** 機和 **[生態系統藍圖](ecosystem-roadmap.md)** 檔。</span><span class="sxs-lookup"><span data-stu-id="ffdb0-128">More details on the strategy behind this decision can be found in the **[classic functions versus virtual terminal](classic-vs-vt.md)** and **[ecosystem roadmap](ecosystem-roadmap.md)** documentation.</span></span>

<span data-ttu-id="ffdb0-129">如需使用高階主控台 i/o 函式的範例，請參閱 [使用 High-Level 輸入和輸出函數](using-the-high-level-input-and-output-functions.md)。</span><span class="sxs-lookup"><span data-stu-id="ffdb0-129">For an example that uses the high-level console I/O functions, see [Using the High-Level Input and Output Functions](using-the-high-level-input-and-output-functions.md).</span></span>