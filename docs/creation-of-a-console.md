---
title: 建立主控台
description: 系統會在啟動主控台程序 (其進入點為主要函式的字元模式程序) 時，建立新的主控台。
author: miniksa
ms.author: miniksa
ms.topic: conceptual
keywords: 主控台, 字元模式應用程式, 命令列應用程式, 終端機應用程式, 主控台 api
MS-HAID:
- '\_win32\_creation\_of\_a\_console'
- base.creation\_of\_a\_console
- consoles.creation\_of\_a\_console
MSHAttr:
- PreferredSiteName:MSDN
- PreferredLib:/library/windows/desktop
ms.assetid: 84ec2559-cade-447e-8594-5b824d3d3e81
ms.localizationpriority: high
ms.openlocfilehash: 09de42ced585e4a644fbbcc04211d5cb6037c2af
ms.sourcegitcommit: 508e93bc83b4bca6ce678f88ab081d66b95d605c
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 12/04/2020
ms.locfileid: "96420277"
---
# <a name="creation-of-a-console"></a><span data-ttu-id="dadb2-104">建立主控台</span><span class="sxs-lookup"><span data-stu-id="dadb2-104">Creation of a Console</span></span>

<span data-ttu-id="dadb2-105">系統會在啟動主控台程序 (其進入點為 **主要** 函式的字元模式程序) 時，建立新的主控台。</span><span class="sxs-lookup"><span data-stu-id="dadb2-105">The system creates a new console when it starts a *console process*, a character-mode process whose entry point is the **main** function.</span></span> <span data-ttu-id="dadb2-106">例如，系統會在啟動命令處理器 `cmd.exe` 時，建立新的主控台。</span><span class="sxs-lookup"><span data-stu-id="dadb2-106">For example, the system creates a new console when it starts the command processor `cmd.exe`.</span></span> <span data-ttu-id="dadb2-107">當命令處理器啟動新的主控台程序時，使用者可以指定系統是否要為新的程序建立新的主控台，或其是否要繼承命令處理器的主控台。</span><span class="sxs-lookup"><span data-stu-id="dadb2-107">When the command processor starts a new console process, the user can specify whether the system creates a new console for the new process or whether it inherits the command processor's console.</span></span>

<span data-ttu-id="dadb2-108">程序可以使用下列其中一種方法來建立主控台：</span><span class="sxs-lookup"><span data-stu-id="dadb2-108">A process can create a console by using one of the following methods:</span></span>

- <span data-ttu-id="dadb2-109">圖形使用者介面 (GUI) 或主控台程序可以使用 [**CreateProcess**](https://msdn.microsoft.com/library/windows/desktop/ms682425) 函式搭配 **CREATE\_NEW\_CONSOLE**，以新的主控台建立主控台程序。</span><span class="sxs-lookup"><span data-stu-id="dadb2-109">A graphical user interface (GUI) or console process can use the [**CreateProcess**](https://msdn.microsoft.com/library/windows/desktop/ms682425) function with **CREATE\_NEW\_CONSOLE** to create a console process with a new console.</span></span> <span data-ttu-id="dadb2-110">(根據預設，主控台程序會繼承其父系的主控台，而且不保證輸入會由其所預期的程序所接收。)</span><span class="sxs-lookup"><span data-stu-id="dadb2-110">(By default, a console process inherits its parent's console, and there is no guarantee that input is received by the process for which it was intended.)</span></span>
- <span data-ttu-id="dadb2-111">目前未連結至主控台的 GUI 或主控台程序可以使用 [**AllocConsole**](allocconsole.md) 函式來建立新的主控台。</span><span class="sxs-lookup"><span data-stu-id="dadb2-111">A GUI or console process that is not currently attached to a console can use the [**AllocConsole**](allocconsole.md) function to create a new console.</span></span> <span data-ttu-id="dadb2-112">(GUI 程序不會在建立時連結至主控台。</span><span class="sxs-lookup"><span data-stu-id="dadb2-112">(GUI processes are not attached to a console when they are created.</span></span> <span data-ttu-id="dadb2-113">使用 [**CreateProcess**](https://msdn.microsoft.com/library/windows/desktop/ms682425) 搭配 **DETACHED\_PROCESS** 建立的主控台程序不會連結至主控台。)</span><span class="sxs-lookup"><span data-stu-id="dadb2-113">Console processes are not attached to a console if they are created using [**CreateProcess**](https://msdn.microsoft.com/library/windows/desktop/ms682425) with **DETACHED\_PROCESS**.)</span></span>

<span data-ttu-id="dadb2-114">一般而言，若在需要與使用者互動時發生錯誤，程序會使用 [**AllocConsole**](allocconsole.md) 來建立主控台。</span><span class="sxs-lookup"><span data-stu-id="dadb2-114">Typically, a process uses [**AllocConsole**](allocconsole.md) to create a console when an error occurs requiring interaction with the user.</span></span> <span data-ttu-id="dadb2-115">例如，GUI 程序可以在發生錯誤而無法使用一般圖形介面時建立主控台，或通常不會與使用者互動的主控台程序可以建立主控台來顯示錯誤。</span><span class="sxs-lookup"><span data-stu-id="dadb2-115">For example, a GUI process can create a console when an error occurs that prevents it from using its normal graphical interface, or a console process that does not normally interact with the user can create a console to display an error.</span></span>

<span data-ttu-id="dadb2-116">程序也可以在 [**CreateProcess**](https://msdn.microsoft.com/library/windows/desktop/ms682425) 的呼叫中指定 **CREATE\_NEW\_CONSOLE** 旗標來建立主控台。</span><span class="sxs-lookup"><span data-stu-id="dadb2-116">A process can also create a console by specifying the **CREATE\_NEW\_CONSOLE** flag in a call to [**CreateProcess**](https://msdn.microsoft.com/library/windows/desktop/ms682425).</span></span> <span data-ttu-id="dadb2-117">此方法會建立子程序可存取但父程序無法存取的新主控台。</span><span class="sxs-lookup"><span data-stu-id="dadb2-117">This method creates a new console that is accessible to the child process but not to the parent process.</span></span> <span data-ttu-id="dadb2-118">個別的主控台可讓父程序和子程序同時與使用者互動，而不會發生衝突。</span><span class="sxs-lookup"><span data-stu-id="dadb2-118">Separate consoles enable both parent and child processes to interact with the user without conflict.</span></span> <span data-ttu-id="dadb2-119">如果建立主控台程序時未指定此旗標，則兩個程序都會連結至相同的主控台，而且不保證輸入會由正確的程序收到。</span><span class="sxs-lookup"><span data-stu-id="dadb2-119">If this flag is not specified when a console process is created, both processes are attached to the same console, and there is no guarantee that the correct process will receive the input intended for it.</span></span> <span data-ttu-id="dadb2-120">應用程式若要避免混淆，可以建立不會繼承輸入緩衝區控制代碼的子程序，或一次只啟用一個子程序來繼承輸入緩衝區控制代碼，並避免父程序在子程序完成之前讀取主控台輸入。</span><span class="sxs-lookup"><span data-stu-id="dadb2-120">Applications can prevent confusion by creating child processes that do not inherit handles of the input buffer, or by enabling only one child process at a time to inherit an input buffer handle while preventing the parent process from reading console input until the child has finished.</span></span>

<span data-ttu-id="dadb2-121">建立新的主控台會產生新的主控台視窗，以及個別的 I/O 畫面緩衝區。</span><span class="sxs-lookup"><span data-stu-id="dadb2-121">Creating a new console results in a new console window, as well as separate I/O screen buffers.</span></span> <span data-ttu-id="dadb2-122">與新主控台相關聯的程序會使用 [**GetStdHandle**](getstdhandle.md) 函式來取得新主控台輸入和畫面緩衝區的控制代碼。</span><span class="sxs-lookup"><span data-stu-id="dadb2-122">The process associated with the new console uses the [**GetStdHandle**](getstdhandle.md) function to get the handles of the new console's input and screen buffers.</span></span> <span data-ttu-id="dadb2-123">這些控制代碼可讓程序存取主控台。</span><span class="sxs-lookup"><span data-stu-id="dadb2-123">These handles enable the process to access the console.</span></span>

<span data-ttu-id="dadb2-124">程序可以在使用 [**CreateProcess**](https://msdn.microsoft.com/library/windows/desktop/ms682425) 時指定 [**STARTUPINFO**](https://msdn.microsoft.com/library/windows/desktop/ms686331) 結構，針對為子程序建立的第一個新主控台 (如果有的話)，該結構的成員會控制其特性。</span><span class="sxs-lookup"><span data-stu-id="dadb2-124">When a process uses [**CreateProcess**](https://msdn.microsoft.com/library/windows/desktop/ms682425), it can specify a [**STARTUPINFO**](https://msdn.microsoft.com/library/windows/desktop/ms686331) structure, whose members control the characteristics of the first new console (if any) created for the child process.</span></span> <span data-ttu-id="dadb2-125">如果指定 **CREATE\_NEW\_CONSOLE** 旗標，在 **CreateProcess** 的呼叫中指定的 **STARTUPINFO** 結構會影響建立的主控台。</span><span class="sxs-lookup"><span data-stu-id="dadb2-125">The **STARTUPINFO** structure specified in the call to **CreateProcess** affects a console created if the **CREATE\_NEW\_CONSOLE** flag is specified.</span></span> <span data-ttu-id="dadb2-126">如果子程序後續使用 [**AllocConsole**](allocconsole.md)，其也會影響所建立的主控台。</span><span class="sxs-lookup"><span data-stu-id="dadb2-126">It also affects a console created if the child process subsequently uses [**AllocConsole**](allocconsole.md).</span></span> <span data-ttu-id="dadb2-127">您可以指定下列主控台特性：</span><span class="sxs-lookup"><span data-stu-id="dadb2-127">The following console characteristics can be specified:</span></span>

- <span data-ttu-id="dadb2-128">新主控台視窗的大小 (以字元資料格表示)</span><span class="sxs-lookup"><span data-stu-id="dadb2-128">Size of the new console window, in character cells</span></span>
- <span data-ttu-id="dadb2-129">新主控台視窗的位置 (以畫面像素座標表示)</span><span class="sxs-lookup"><span data-stu-id="dadb2-129">Location of the new console window, in screen pixel coordinates</span></span>
- <span data-ttu-id="dadb2-130">新主控台畫面緩衝區的大小 (以字元資料格表示)</span><span class="sxs-lookup"><span data-stu-id="dadb2-130">Size of the new console's screen buffer, in character cells</span></span>
- <span data-ttu-id="dadb2-131">新主控台畫面緩衝區的文字和背景色彩屬性</span><span class="sxs-lookup"><span data-stu-id="dadb2-131">Text and background color attributes of the new console's screen buffer</span></span>
- <span data-ttu-id="dadb2-132">新主控台視窗標題列的顯示名稱</span><span class="sxs-lookup"><span data-stu-id="dadb2-132">Display name for the title bar of the new console's window</span></span>

<span data-ttu-id="dadb2-133">如果未指定 [**STARTUPINFO**](https://msdn.microsoft.com/library/windows/desktop/ms686331) 值，系統會使用預設值。</span><span class="sxs-lookup"><span data-stu-id="dadb2-133">The system uses default values if the [**STARTUPINFO**](https://msdn.microsoft.com/library/windows/desktop/ms686331) values are not specified.</span></span> <span data-ttu-id="dadb2-134">子程序可以使用 [**GetStartupInfo**](https://msdn.microsoft.com/library/windows/desktop/ms683230) 函式來判斷其 **STARTUPINFO** 結構中的值。</span><span class="sxs-lookup"><span data-stu-id="dadb2-134">A child process can use the [**GetStartupInfo**](https://msdn.microsoft.com/library/windows/desktop/ms683230) function to determine the values in its **STARTUPINFO** structure.</span></span>

<span data-ttu-id="dadb2-135">程序無法變更其主控台視窗在畫面上的位置，但是您可以使用下列主控台函式來設定或擷取 [**STARTUPINFO**](https://msdn.microsoft.com/library/windows/desktop/ms686331) 結構中指定的其他屬性。</span><span class="sxs-lookup"><span data-stu-id="dadb2-135">A process cannot change the location of its console window on the screen, but the following console functions are available to set or retrieve the other properties specified in the [**STARTUPINFO**](https://msdn.microsoft.com/library/windows/desktop/ms686331) structure.</span></span>

| <span data-ttu-id="dadb2-136">函式</span><span class="sxs-lookup"><span data-stu-id="dadb2-136">Function</span></span> | <span data-ttu-id="dadb2-137">說明</span><span class="sxs-lookup"><span data-stu-id="dadb2-137">Description</span></span> |
|-|-|
| [<span data-ttu-id="dadb2-138">**GetConsoleScreenBufferInfo**</span><span class="sxs-lookup"><span data-stu-id="dadb2-138">**GetConsoleScreenBufferInfo**</span></span>](getconsolescreenbufferinfo.md) | <span data-ttu-id="dadb2-139">擷取視窗大小、畫面緩衝區大小和色彩屬性。</span><span class="sxs-lookup"><span data-stu-id="dadb2-139">Retrieves the window size, screen buffer size, and color attributes.</span></span> |
| [<span data-ttu-id="dadb2-140">**SetConsoleWindowInfo**</span><span class="sxs-lookup"><span data-stu-id="dadb2-140">**SetConsoleWindowInfo**</span></span>](setconsolewindowinfo.md)  | <span data-ttu-id="dadb2-141">變更控制台視窗的大小。</span><span class="sxs-lookup"><span data-stu-id="dadb2-141">Changes the size of the console window.</span></span>  |
| [<span data-ttu-id="dadb2-142">**SetConsoleScreenBufferSize**</span><span class="sxs-lookup"><span data-stu-id="dadb2-142">**SetConsoleScreenBufferSize**</span></span>](setconsolescreenbuffersize.md) | <span data-ttu-id="dadb2-143">變更主控台畫面緩衝區的大小。</span><span class="sxs-lookup"><span data-stu-id="dadb2-143">Changes the size of the console screen buffer.</span></span> |
| [<span data-ttu-id="dadb2-144">**SetConsoleTextAttribute**</span><span class="sxs-lookup"><span data-stu-id="dadb2-144">**SetConsoleTextAttribute**</span></span>](setconsoletextattribute.md) | <span data-ttu-id="dadb2-145">設定色彩屬性。</span><span class="sxs-lookup"><span data-stu-id="dadb2-145">Sets the color attributes.</span></span>  |
| [<span data-ttu-id="dadb2-146">**SetConsoleTitle**</span><span class="sxs-lookup"><span data-stu-id="dadb2-146">**SetConsoleTitle**</span></span>](setconsoletitle.md)  | <span data-ttu-id="dadb2-147">設定主控台視窗標題。</span><span class="sxs-lookup"><span data-stu-id="dadb2-147">Sets the console window title.</span></span> |
| [<span data-ttu-id="dadb2-148">**GetConsoleTitle**</span><span class="sxs-lookup"><span data-stu-id="dadb2-148">**GetConsoleTitle**</span></span>](getconsoletitle.md)  | <span data-ttu-id="dadb2-149">擷取主控台視窗標題。</span><span class="sxs-lookup"><span data-stu-id="dadb2-149">Retrieves the console window title.</span></span>  |

<span data-ttu-id="dadb2-150">程序可以使用 [**FreeConsole**](freeconsole.md) 函式，將自己從繼承的主控台或由 [**AllocConsole**](allocconsole.md) 所建立的主控台卸離。</span><span class="sxs-lookup"><span data-stu-id="dadb2-150">A process can use the [**FreeConsole**](freeconsole.md) function to detach itself from an inherited console or from a console created by [**AllocConsole**](allocconsole.md).</span></span>

<span data-ttu-id="dadb2-151">程序使用 [**FreeConsole**](freeconsole.md) 從自己的工作階段卸離後 (或者，如果沒有任何連結的工作階段)，可以使用 [**AttachConsole**](attachconsole.md) 函式將本身連結至另一個現有的主控台工作階段。</span><span class="sxs-lookup"><span data-stu-id="dadb2-151">A process can use the [**AttachConsole**](attachconsole.md) function to attach itself to another existing console session after using [**FreeConsole**](freeconsole.md) to detach from its own session (or if there is otherwise no attached session).</span></span>
